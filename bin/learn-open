#!/usr/bin/env ruby

require 'learn_open'

config_path = File.expand_path('~/.learn-config')
editor_data = YAML.load(File.read(config_path))[:editor]
lesson = nil

configured_editor = !(editor_data.empty? || editor_data.nil?) ? editor_data : nil
editor_specified = ARGV.detect {|arg| arg.start_with?('--editor=')}.match(/\-\-editor=(.+)/) || configured_editor
open_after = !!editor_specified

if !ARGV[0].start_with?('--editor=')
  lesson = ARGV[0]
end

if open_after
  editor_specified = editor_specified.is_a?(String) ? editor_specified : editor_specified[1]
end

LearnOpen::Opener.run(lesson: lesson, editor_specified: editor_specified)
